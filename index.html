<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Naukri Clone</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; }
    .navbar { background: #004080; }
    .navbar-brand, .nav-link { color: white !important; }
    .hero { background: url('https://source.unsplash.com/1600x400/?office,work') center/cover no-repeat; height: 300px; display: flex; justify-content: center; align-items: center; color: white; font-size: 2rem; font-weight: bold; }
    .card { transition: transform 0.3s; margin-bottom: 20px; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2);}
    .hidden { display: none; }
    .back-btn { margin-top: 10px; }
    #jobList { max-height: 400px; overflow-y: auto; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Naukri Clone</a>
    <button class="btn btn-light ms-auto" onclick="showSection('home')">Home</button>
  </div>
</nav>

<div class="hero">Find Your Dream Job</div>

<div class="container my-4">
  <!-- Home -->
  <div id="home">
    <div class="text-center mb-4">
      <button class="btn btn-primary" onclick="showSection('applicantRegister')">Applicant Register</button>
      <button class="btn btn-success" onclick="showSection('hrRegister')">HR Register</button>
      <button class="btn btn-outline-primary" onclick="showSection('applicantLogin')">Applicant Login</button>
      <button class="btn btn-outline-success" onclick="showSection('hrLogin')">HR Login</button>
    </div>
  </div>

  <!-- Applicant Register -->
  <div id="applicantRegister" class="hidden">
    <h3>Applicant Register</h3>
    <form id="applicantRegisterForm">
      <input class="form-control mb-2" name="name" placeholder="Full Name" required>
      <input class="form-control mb-2" name="email" type="email" placeholder="Email" required>
      <input class="form-control mb-2" name="phone" placeholder="Phone Number" required>
      <input class="form-control mb-2" name="dob" type="date" placeholder="Date of Birth">
      <input class="form-control mb-2" name="education" placeholder="Education">
      <input class="form-control mb-2" name="certifications" placeholder="Certifications">
      <input class="form-control mb-2" name="skills" placeholder="Skills (comma separated)">
      <input class="form-control mb-2" name="password" type="password" placeholder="Password" required>
      <button type="submit" class="btn btn-primary">Register</button>
    </form>
    <button class="btn btn-secondary back-btn" onclick="showSection('home')">Back</button>
  </div>

  <!-- HR Register -->
  <div id="hrRegister" class="hidden">
    <h3>HR Register</h3>
    <form id="hrRegisterForm">
      <input class="form-control mb-2" name="company" placeholder="Company Name" required>
      <input class="form-control mb-2" name="email" type="email" placeholder="Company Email" required>
      <input class="form-control mb-2" name="phone" placeholder="Phone Number" required>
      <input class="form-control mb-2" name="website" placeholder="Website">
      <input class="form-control mb-2" name="password" type="password" placeholder="Password" required>
      <button type="submit" class="btn btn-success">Register</button>
    </form>
    <button class="btn btn-secondary back-btn" onclick="showSection('home')">Back</button>
  </div>

  <!-- Applicant Login -->
  <div id="applicantLogin" class="hidden">
    <h3>Applicant Login</h3>
    <form id="applicantLoginForm">
      <input class="form-control mb-2" name="email" type="email" placeholder="Email" required>
      <input class="form-control mb-2" name="password" type="password" placeholder="Password" required>
      <button type="submit" class="btn btn-primary">Login</button>
    </form>
    <button class="btn btn-secondary back-btn" onclick="showSection('home')">Back</button>
  </div>

  <!-- HR Login -->
  <div id="hrLogin" class="hidden">
    <h3>HR Login</h3>
    <form id="hrLoginForm">
      <input class="form-control mb-2" name="email" type="email" placeholder="Email" required>
      <input class="form-control mb-2" name="password" type="password" placeholder="Password" required>
      <button type="submit" class="btn btn-success">Login</button>
    </form>
    <button class="btn btn-secondary back-btn" onclick="showSection('home')">Back</button>
  </div>

  <!-- Applicant Dashboard -->
  <div id="applicantDashboard" class="hidden">
    <h3>Applicant Dashboard</h3>
    <div id="jobList" class="row"></div>
    <h5 class="mt-4">Applied Jobs</h5>
    <ul id="appliedJobs"></ul>
    <button class="btn btn-secondary back-btn" onclick="logout()">Logout</button>
  </div>

  <!-- HR Dashboard -->
  <div id="hrDashboard" class="hidden">
    <h3>HR Dashboard</h3>
    <form id="postJobForm">
      <input class="form-control mb-2" name="title" placeholder="Job Title" required>
      <textarea class="form-control mb-2" name="description" placeholder="Job Description"></textarea>
      <input class="form-control mb-2" name="location" placeholder="Location">
      <input class="form-control mb-2" name="salary" placeholder="Salary">
      <button type="submit" class="btn btn-success">Post Job</button>
    </form>
    <h5 class="mt-4">Posted Jobs</h5>
    <ul id="postedJobs"></ul>
    <button class="btn btn-secondary back-btn" onclick="logout()">Logout</button>
  </div>
</div>

<script>
const backend = "https://backend-ats-z0tb.onrender.com"; 

function showSection(id){
  document.querySelectorAll(".container > div").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

function logout(){ showSection("home"); }

let currentUser = null; // store logged in user
let currentRole = null;  // 'applicant' or 'hr'

// --- Registration & Login ---
document.getElementById("applicantRegisterForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const f = e.target;
  try {
    const res = await axios.post(`${backend}/register/applicant`, {
      name: f.name.value, email: f.email.value, phone: f.phone.value, dob: f.dob.value,
      education: f.education.value, certifications: f.certifications.value, skills: f.skills.value,
      password: f.password.value
    });
    alert(res.data.message);
    showSection("applicantLogin");
  } catch(err){ alert(err.response.data.error); }
});

document.getElementById("hrRegisterForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const f = e.target;
  try {
    const res = await axios.post(`${backend}/register/hr`, {
      company: f.company.value, email: f.email.value, phone: f.phone.value,
      website: f.website.value, password: f.password.value
    });
    alert(res.data.message);
    showSection("hrLogin");
  } catch(err){ alert(err.response.data.error); }
});

document.getElementById("applicantLoginForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const f = e.target;
  try {
    const res = await axios.post(`${backend}/login/applicant`, {email:f.email.value,password:f.password.value});
    alert(res.data.message);
    currentUser = f.email.value; currentRole="applicant";
    showSection("applicantDashboard"); loadJobs(); loadAppliedJobs();
  } catch(err){ alert(err.response.data.error); }
});

document.getElementById("hrLoginForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const f = e.target;
  try {
    const res = await axios.post(`${backend}/login/hr`, {email:f.email.value,password:f.password.value});
    alert(res.data.message);
    currentUser = f.email.value; currentRole="hr";
    showSection("hrDashboard"); loadPostedJobs();
  } catch(err){ alert(err.response.data.error); }
});

// --- Jobs ---
async function loadJobs(){
  let res = await axios.get(`${backend}/jobs`);
  let jobList = document.getElementById("jobList");
  jobList.innerHTML = "";
  res.data.forEach(job=>{
    jobList.innerHTML+=`
      <div class="col-md-4">
        <div class="card p-3">
          <h5>${job.title}</h5>
          <p>${job.description}</p>
          <button class="btn btn-primary" onclick="applyJob('${job.id}')">Apply</button>
        </div>
      </div>`;
  });
}

async function applyJob(jobId){
  try {
    const res = await axios.post(`${backend}/apply`, {job_id:jobId,email:currentUser});
    alert(res.data.message);
    loadAppliedJobs();
  } catch(err){ alert(err.response.data.error); }
}

async function loadAppliedJobs(){
  let res = await axios.get(`${backend}/applied/${currentUser}`);
  let ul = document.getElementById("appliedJobs"); ul.innerHTML="";
  res.data.forEach(a=>{
    ul.innerHTML+=`<li>${a.job_id} - Applied</li>`;
  });
}

// --- HR Jobs ---
document.getElementById("postJobForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const f = e.target;
  try{
    const res = await axios.post(`${backend}/jobs`, {title:f.title.value,description:f.description.value,location:f.location.value,salary:f.salary.value,hr_email:currentUser});
    alert(res.data.message);
    loadPostedJobs();
  }catch(err){alert(err);}
});

async function loadPostedJobs(){
  let res = await axios.get(`${backend}/jobs`);
  let ul = document.getElementById("postedJobs"); ul.innerHTML="";
  res.data.filter(j=>j.hr_email===currentUser).forEach(j=>{
    ul.innerHTML+=`<li>${j.title} - ${j.description}</li>`;
  });
}
</script>
